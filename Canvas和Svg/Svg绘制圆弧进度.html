<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arc-block {
            width: 148px;
            height: 148px;
        }

        .test-block {
            margin: 60px;
        }
    </style>
</head>

<body>

    <!-- 渐变可能会失效，需要加入gradientUnits="userSpaceOnUse" -->
    <div class="test-block">

        <svg viewBox="0 0 100 100" width="100" height="100">
            <defs>
                <linearGradient x1=".5" y1="0" x2=".5" y2="1" id="arc-ring">
                    <stop offset="0" stop-color="#e8f0ff" stop-opacity="1"></stop>
                    <stop offset="1" stop-color="#f0f0f5" stop-opacity="0"></stop>
                </linearGradient>
            </defs>
            <path d="M50 50 m0 45 a45 45 0 1 1 0 -90 a45 45 0 1 1 0 90" stroke-width="10" fill="none" stroke="red">
            </path>
        </svg>
    </div>

    <div class="arc-block" id="arcId">

    </div>

</body>

<script>
    // R      WIDTH      stroke-width
    // 60     148     28
    // 

    // 60     120+14+14   14+14
    // 40.54  100         18.9
    // const outerR = 60;

    // 按100宽度来算，画笔宽度x
    const generateArcRingPath = (strokeWidth, R) => {
        const d = `M50 50 m0 ${R} a${R} ${R} 0 1 1 0 -${2 * R} a${R} ${R} 0 1 1 0 ${2 * R}`
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', d);
        path.setAttribute('stroke-width', strokeWidth);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', 'url(#arc-ring)');
        return path;
    }


    const generateArcTrackPath = (pWidth, R) => {
        const strokeWidth = parseInt(pWidth / 3);
        const d = `M50 50 m0 ${R} a${R} ${R} 0 1 1 0 -${2 * R} a${R} ${R} 0 1 1 0 ${2 * R}`
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', d);
        path.setAttribute('stroke-width', strokeWidth);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke-linecap', 'round');
        path.setAttribute('stroke', '#aab9d7');
        const Rate = 0.65;
        const perimeter = 2 * Math.PI * R;
        path.setAttribute('stroke-dasharray', `${perimeter * Rate}px, ${perimeter}px`)
        // offset负数时 -1 顺时针旋转
        const offset = -1 * (perimeter * (1 - Rate) / 2);
        path.setAttribute('stroke-dashoffset', `${offset}px`);
        return path;
    }
    const generateArcPath = (pWidth, R, percentage = 100) => {
        const strokeWidth = parseInt(pWidth / 3);
        const d = `M50 50 m0 ${R} a${R} ${R} 0 1 1 0 -${2 * R} a${R} ${R} 0 1 1 0 ${2 * R}`
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.style.cssText = `transition: stroke-dasharray 0.6s ease 0s,stroke .6s ease 0s`
        path.setAttribute('d', d);
        path.setAttribute('stroke-width', percentage === 0 ? 0 : strokeWidth);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke-linecap', 'round');
        path.setAttribute('stroke', 'red');

        const Rate = 0.65;
        const perimeter = 2 * Math.PI * R;
        path.setAttribute('stroke-dasharray', `${perimeter * Rate * (percentage / 100)}px, ${perimeter}px`)
        // offset负数时 -1 顺时针旋转
        const offset = -1 * (perimeter * (1 - Rate) / 2);
        path.setAttribute('stroke-dashoffset', `${offset}px`);

        return path;
    }
    const updateSvgPath = (pWidth, path, R, percentage) => {
        const strokeWidth = parseInt(pWidth / 3);

        const Rate = 0.65;
        const perimeter = 2 * Math.PI * R;
        path.setAttribute('stroke-width', percentage === 0 ? 0 : strokeWidth);

        path.setAttribute('stroke-dasharray', `${perimeter * Rate * (percentage / 100)}px, ${perimeter}px`)
        // offset负数时 -1 顺时针旋转
        const offset = -1 * (perimeter * (1 - Rate) / 2);
        path.setAttribute('stroke-dashoffset', `${offset}px`);
    }

    const arcId = document.getElementById('arcId');

    const createSvg = () => {
        const arcSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        arcSvg.setAttribute('viewBox', '0 0 100 100');
        const pWidth = 20;
        // 同心圆
        const R = parseInt(50 - pWidth / 2, 10);

        arcSvg.appendChild(generateArcRingPath(pWidth, R));
        arcSvg.appendChild(generateArcTrackPath(pWidth, R))
        const path = generateArcPath(pWidth, R, 0);
        arcSvg.appendChild(path);
        arcId.appendChild(arcSvg);

        setTimeout(() => {
            updateSvgPath(pWidth, path, R, 40)
        }, 1000);
    }

    createSvg();




</script>

</html>